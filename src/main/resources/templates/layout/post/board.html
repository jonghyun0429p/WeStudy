<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <th:block th:replace="~{layout/layout :: head}"></th:block>

    <style>
        .hover-effect {
            transition: all .2s ease-in-out;
        }
        .hover-effect:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark">

<div th:replace="~{layout/layout :: layout(~{::content})}">
    <div th:fragment="content" class="px-4 md:px-10 lg:px-20 xl:px-40">

        <!-- í—¤ë” ì˜ì—­ -->
        <div class="flex flex-wrap justify-between gap-2 p-2 mb-2 mt-6">
            <div class="flex flex-col gap-2">
                <p class="text-4xl font-black">ğŸ“‹ ê²Œì‹œê¸€ ëª©ë¡</p>
                <p class="text-muted-light dark:text-muted-dark pl1">ì›í•˜ëŠ” ê²Œì‹œê¸€ì„ ì°¾ì•„ë³´ì„¸ìš”.</p>
            </div>
        </div>

        <!-- ê²€ìƒ‰ì°½ -->
        <form th:action="@{/page/post/search}" method="get" class="flex flex-col md:flex-row gap-4 p-4">
            <div class="flex-grow">
                <label class="flex flex-col w-full h-12">
                    <div class="flex h-full items-stretch rounded-full">
                        <div class="flex items-center justify-center px-4 bg-border-light dark:bg-border-dark text-muted-light dark:text-muted-dark rounded-l-full">
                            <span class="material-symbols-outlined">search</span>
                        </div>
                        <input name="keyword" required
                               class="flex-1 rounded-r-full bg-border-light dark:bg-border-dark px-4 text-base focus:outline-none"
                               placeholder="ê²Œì‹œê¸€ ê²€ìƒ‰"/>
                    </div>
                </label>
            </div>
        </form>

        <!-- ê²Œì‹œê¸€ ëª©ë¡ ì¹´ë“œ ê·¸ë¦¬ë“œ -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 p-4">

            <div th:each="post : ${pages}"
                 class="flex flex-col gap-3 rounded-xl bg-card-light dark:bg-card-dark shadow-sm overflow-hidden hover-effect cursor-pointer"
                 th:onclick="'location.href=\'/page/post/detail?id=' + ${post.postId} + '\''">

                <!-- ì¸ë„¤ì¼ì€ ì„ì‹œ ìƒ‰ ë°°ê²½ -->
                <div class="w-full bg-center bg-no-repeat aspect-video bg-cover"
                     style="background-image: url('https://picsum.photos/seed/card/600/400');">
                </div>

                <div class="p-4 flex flex-col gap-2">
                    <p class="text-base font-bold truncate" th:text="${post.title}">ì œëª©</p>

                    <div class="flex items-center gap-4 text-muted-light dark:text-muted-dark text-sm">
                        <div class="flex items-center gap-1">
                            <span class="material-symbols-outlined !text-base">category</span>
                            <span th:text="${post.postCategory}">ì¹´í…Œê³ ë¦¬</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <span class="material-symbols-outlined !text-base">visibility</span>
                            <span th:text="${post.views}">0</span>
                        </div>
                    </div>

                    <p class="text-sm text-muted-light dark:text-muted-dark line-clamp-2" th:text="${post.summary}">
                        ìš”ì•½ ë‚´ìš©
                    </p>
                </div>
            </div>
        </div>

        <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div class="flex justify-center p-4 mt-8">
            <div class="flex items-center gap-2">

                <!-- ë§¨ ì²˜ìŒ í˜ì´ì§€ ë²„íŠ¼ -->
                <a th:href="@{/page/post(page=1)}"
                   class="flex items-center justify-center h-10 w-10 rounded-full bg-border-light dark:bg-border-dark text-muted-light hover:bg-primary/20 transition"
                   th:classappend="${currentPage == 1} ? ' opacity-40 pointer-events-none' : ''">
                    <span class="material-symbols-outlined">first_page</span>
                </a>

                <!-- ì´ì „ í˜ì´ì§€ ë²„íŠ¼ -->
                <a th:href="@{/page/post(page=${currentPage - 1 > 0 ? currentPage - 1 : 1})}"
                   class="flex items-center justify-center h-10 w-10 rounded-full bg-border-light dark:bg-border-dark text-muted-light hover:bg-primary/20 transition"
                   th:classappend="${currentPage == 1} ? ' opacity-40 pointer-events-none' : ''">
                    <span class="material-symbols-outlined">chevron_left</span>
                </a>

                <!-- ê°€ìš´ë° í˜ì´ì§€ ë²ˆí˜¸ë“¤ (í˜„ì¬ ê¸°ì¤€ ì¢Œìš° ìµœëŒ€ 2ê°œ) -->
                <div th:each="i : ${#numbers.sequence(1, pageCount)}"
                     th:if="${i >= currentPage - 2} and ${i <= currentPage + 2}">
                    <a th:href="@{/page/post(page=${i})}"
                       th:text="${i}"
                       class="flex items-center justify-center h-10 w-10 rounded-full text-sm font-medium transition"
                       th:classappend="${i == currentPage} ?
                   ' bg-primary text-text-light font-bold'
                   : ' bg-border-light dark:bg-border-dark text-muted-light hover:bg-primary/20'">
                    </a>
                </div>

                <!-- ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼ -->
                <a th:href="@{/page/post(page=${currentPage + 1 < pageCount ? currentPage + 1 : pageCount})}"
                   class="flex items-center justify-center h-10 w-10 rounded-full bg-border-light dark:bg-border-dark text-muted-light hover:bg-primary/20 transition"
                   th:classappend="${currentPage == pageCount} ? ' opacity-40 pointer-events-none' : ''">
                    <span class="material-symbols-outlined">chevron_right</span>
                </a>

                <!-- ë§¨ ë§ˆì§€ë§‰ í˜ì´ì§€ ë²„íŠ¼ -->
                <a th:href="@{/page/post(page=${pageCount})}"
                   class="flex items-center justify-center h-10 w-10 rounded-full bg-border-light dark:bg-border-dark text-muted-light hover:bg-primary/20 transition"
                   th:classappend="${currentPage == pageCount} ? ' opacity-40 pointer-events-none' : ''">
                    <span class="material-symbols-outlined">last_page</span>
                </a>

            </div>
        </div>



        <!-- ê¸€ ì‘ì„± ë²„íŠ¼ -->
        <th:block th:if="${nickname != null}">
            <a href="/page/post/write"
               class="fixed bottom-10 right-8 flex items-center justify-center h-16 w-16 rounded-full bg-primary text-text-light shadow-lg hover:opacity-90 transition">
                <span class="material-symbols-outlined !text-3xl">add</span>
            </a>
        </th:block>

    </div>
</div>
<script>
    (function () {
        // ì¿ í‚¤ì—ì„œ postSize ì½ê¸°
        const cookieMatch = document.cookie.match(/(?:^|;\s*)postSize=(\d+)/);
        const currentSize = cookieMatch ? parseInt(cookieMatch[1], 10) : 0;

        // í™”ë©´ ê°€ë¡œ ê¸¸ì´ ê¸°ì¤€ìœ¼ë¡œ ì—´ ê°œìˆ˜ ê³„ì‚°
        const width = window.innerWidth;
        let cols;
        if (width < 640) {          // ëª¨ë°”ì¼
            cols = 1;
        } else if (width < 1024) {  // ì‘ì€ íƒœë¸”ë¦¿ / ì‘ì€ í™”ë©´
            cols = 2;
        } else if (width < 1280) {  // ì¼ë°˜ ë…¸íŠ¸ë¶
            cols = 3;
        } else {                    // í° ë°ìŠ¤í¬íƒ‘
            cols = 4;
        }

        const rows = 3; // í•­ìƒ 3ì¤„
        const desiredSize = cols * rows;

        // ì´ë¯¸ ì›í•˜ëŠ” sizeë¡œ ë¡œë“œë˜ì–´ ìˆìœ¼ë©´ ì•„ë¬´ê²ƒë„ ì•ˆ í•¨
        if (currentSize === desiredSize) {
            return;
        }

        // ì¿ í‚¤ì— ì €ì¥ (30ì¼ ìœ ì§€)
        document.cookie = "postSize=" + desiredSize + "; path=/; max-age=2592000";

        // page ì—†ìœ¼ë©´ 1ë¡œ, ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ
        const params = new URLSearchParams(window.location.search);
        if (!params.get("page")) {
            params.set("page", "1");
        }

        // ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì€ pageë§Œ ìœ ì§€í•œ ì±„ë¡œ ë¦¬ë¡œë“œ (sizeëŠ” ì•ˆ ë¶™ì„)
        const query = params.toString();
        const baseUrl = window.location.pathname;
        window.location.href = query ? baseUrl + "?" + query : baseUrl;
    })();
</script>

</body>
</html>
