<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">

<head>
    <th:block th:replace="~{layout/layout :: head}"></th:block>

</head>

<body>

    <div th:replace="~{layout/layout :: layout(~{::content})}">
        <div th:fragment="content" class="px-4 md:px-10 lg:px-20 xl:px-40">

            <!-- Ìó§Îçî ÏòÅÏó≠ -->
            <div class="flex flex-wrap justify-between gap-2 p-2 mb-2 mt-6">
                <div class="flex flex-col gap-2">
                    <p class="text-4xl font-black">üìã Í≤åÏãúÍ∏Ä Î™©Î°ù</p>
                    <p class="text-muted-light dark:text-muted-dark pl1">ÏõêÌïòÎäî Í≤åÏãúÍ∏ÄÏùÑ Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî.</p>
                </div>
            </div>

            <!-- Í≤ÄÏÉâÏ∞Ω -->
            <form th:action="@{/page/post/search}" method="get" class="flex flex-col md:flex-row gap-4 p-4">
                <div class="flex-grow">
                    <label class="flex flex-col w-full h-12">
                        <div class="flex h-full items-stretch rounded-full">
                            <div
                                class="flex items-center justify-center px-4 bg-border-light dark:bg-border-dark text-muted-light dark:text-muted-dark rounded-l-full">
                                <span class="material-symbols-outlined">search</span>
                            </div>
                            <input name="keyword" required
                                class="flex-1 rounded-r-full bg-border-light dark:bg-border-dark px-4 text-base focus:outline-none"
                                placeholder="Í≤åÏãúÍ∏Ä Í≤ÄÏÉâ" />
                        </div>
                    </label>
                </div>
            </form>

            <!-- Í≤åÏãúÍ∏Ä Î™©Î°ù Ïπ¥Îìú Í∑∏Î¶¨Îìú -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 p-4">

                <div th:each="post : ${pages}"
                    class="flex flex-col gap-3 rounded-xl bg-card-light dark:bg-card-dark shadow-sm overflow-hidden hover-effect cursor-pointer"
                    th:onclick="'location.href=\'/page/post/detail?id=' + ${post.postId} + '\''">

                    <!-- Ïç∏ÎÑ§ÏùºÏùÄ ÏûÑÏãú ÏÉâ Î∞∞Í≤Ω -->
                    <div class="w-full bg-center bg-no-repeat aspect-video bg-cover"
                        style="background-image: url('https://picsum.photos/seed/card/600/400');">
                    </div>

                    <div class="p-4 flex flex-col gap-2">
                        <p class="text-base font-bold truncate" th:text="${post.title}">Ï†úÎ™©</p>

                        <div class="flex items-center gap-4 text-muted-light dark:text-muted-dark text-sm">
                            <div class="flex items-center gap-1">
                                <span class="material-symbols-outlined !text-base">category</span>
                                <span th:text="${post.postCategory}">Ïπ¥ÌÖåÍ≥†Î¶¨</span>
                            </div>
                            <div class="flex items-center gap-1">
                                <span class="material-symbols-outlined !text-base">visibility</span>
                                <span th:text="${post.views}">0</span>
                            </div>
                        </div>

                        <p class="text-sm text-muted-light dark:text-muted-dark line-clamp-2" th:text="${post.summary}">
                            ÏöîÏïΩ ÎÇ¥Ïö©
                        </p>
                    </div>
                </div>
            </div>

            <!-- ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
            <div class="flex justify-center p-4 mt-8">
                <div class="flex items-center gap-2">

                    <!-- Îß® Ï≤òÏùå ÌéòÏù¥ÏßÄ Î≤ÑÌäº -->
                    <a th:href="@{/page/post(page=1)}"
                        class="flex items-center justify-center h-10 w-10 rounded-full bg-border-light dark:bg-border-dark text-muted-light hover:bg-primary/20 transition"
                        th:classappend="${currentPage == 1} ? ' opacity-40 pointer-events-none' : ''">
                        <span class="material-symbols-outlined">first_page</span>
                    </a>

                    <!-- Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄ Î≤ÑÌäº -->
                    <a th:href="@{/page/post(page=${currentPage - 1 > 0 ? currentPage - 1 : 1})}"
                        class="flex items-center justify-center h-10 w-10 rounded-full bg-border-light dark:bg-border-dark text-muted-light hover:bg-primary/20 transition"
                        th:classappend="${currentPage == 1} ? ' opacity-40 pointer-events-none' : ''">
                        <span class="material-symbols-outlined">chevron_left</span>
                    </a>

                    <!-- Í∞ÄÏö¥Îç∞ ÌéòÏù¥ÏßÄ Î≤àÌò∏Îì§ (ÌòÑÏû¨ Í∏∞Ï§Ä Ï¢åÏö∞ ÏµúÎåÄ 2Í∞ú) -->
                    <div th:each="i : ${#numbers.sequence(1, pageCount)}"
                        th:if="${i >= currentPage - 2} and ${i <= currentPage + 2}">
                        <a th:href="@{/page/post(page=${i})}" th:text="${i}"
                            class="flex items-center justify-center h-10 w-10 rounded-full text-sm font-medium transition"
                            th:classappend="${i == currentPage} ?
                   ' bg-primary text-text-light font-bold'
                   : ' bg-border-light dark:bg-border-dark text-muted-light hover:bg-primary/20'">
                        </a>
                    </div>

                    <!-- Îã§Ïùå ÌéòÏù¥ÏßÄ Î≤ÑÌäº -->
                    <a th:href="@{/page/post(page=${currentPage + 1 < pageCount ? currentPage + 1 : pageCount})}"
                        class="flex items-center justify-center h-10 w-10 rounded-full bg-border-light dark:bg-border-dark text-muted-light hover:bg-primary/20 transition"
                        th:classappend="${currentPage == pageCount} ? ' opacity-40 pointer-events-none' : ''">
                        <span class="material-symbols-outlined">chevron_right</span>
                    </a>

                    <!-- Îß® ÎßàÏßÄÎßâ ÌéòÏù¥ÏßÄ Î≤ÑÌäº -->
                    <a th:href="@{/page/post(page=${pageCount})}"
                        class="flex items-center justify-center h-10 w-10 rounded-full bg-border-light dark:bg-border-dark text-muted-light hover:bg-primary/20 transition"
                        th:classappend="${currentPage == pageCount} ? ' opacity-40 pointer-events-none' : ''">
                        <span class="material-symbols-outlined">last_page</span>
                    </a>

                </div>
            </div>



            <!-- Í∏Ä ÏûëÏÑ± Î≤ÑÌäº -->
            <th:block th:if="${nickname != null}">
                <a href="/page/post/write"
                    class="fixed bottom-10 right-8 flex items-center justify-center h-16 w-16 rounded-full bg-primary text-text-light shadow-lg hover:opacity-90 transition">
                    <span class="material-symbols-outlined !text-3xl">add</span>
                </a>
            </th:block>

        </div>
    </div>
    <script>
        (function () {
            // Ïø†ÌÇ§ÏóêÏÑú postSize ÏùΩÍ∏∞
            const cookieMatch = document.cookie.match(/(?:^|;\s*)postSize=(\d+)/);
            const currentSize = cookieMatch ? parseInt(cookieMatch[1], 10) : 0;

            // ÌôîÎ©¥ Í∞ÄÎ°ú Í∏∏Ïù¥ Í∏∞Ï§ÄÏúºÎ°ú Ïó¥ Í∞úÏàò Í≥ÑÏÇ∞
            const width = window.innerWidth;
            let cols;
            if (width < 640) {          // Î™®Î∞îÏùº
                cols = 1;
            } else if (width < 1024) {  // ÏûëÏùÄ ÌÉúÎ∏îÎ¶ø / ÏûëÏùÄ ÌôîÎ©¥
                cols = 2;
            } else if (width < 1280) {  // ÏùºÎ∞ò ÎÖ∏Ìä∏Î∂Å
                cols = 3;
            } else {                    // ÌÅ∞ Îç∞Ïä§ÌÅ¨ÌÉë
                cols = 4;
            }

            const rows = 3; // Ìï≠ÏÉÅ 3Ï§Ñ
            const desiredSize = cols * rows;

            // Ïù¥ÎØ∏ ÏõêÌïòÎäî sizeÎ°ú Î°úÎìúÎêòÏñ¥ ÏûàÏúºÎ©¥ ÏïÑÎ¨¥Í≤ÉÎèÑ Ïïà Ìï®
            if (currentSize === desiredSize) {
                return;
            }

            // Ïø†ÌÇ§Ïóê Ï†ÄÏû• (30Ïùº Ïú†ÏßÄ)
            document.cookie = "postSize=" + desiredSize + "; path=/; max-age=2592000";

            // page ÏóÜÏúºÎ©¥ 1Î°ú, ÏûàÏúºÎ©¥ Í∑∏ÎåÄÎ°ú
            const params = new URLSearchParams(window.location.search);
            if (!params.get("page")) {
                params.set("page", "1");
            }

            // ÏøºÎ¶¨Ïä§Ìä∏ÎßÅÏùÄ pageÎßå Ïú†ÏßÄÌïú Ï±ÑÎ°ú Î¶¨Î°úÎìú (sizeÎäî Ïïà Î∂ôÏûÑ)
            const query = params.toString();
            const baseUrl = window.location.pathname;
            window.location.href = query ? baseUrl + "?" + query : baseUrl;
        })();
    </script>

</body>

</html>