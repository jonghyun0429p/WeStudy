<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">

<head>
    <th:block th:replace="~{layout/layout :: head}"></th:block>
</head>

<body>
    <div th:replace="~{layout/layout :: layout(~{::content})}" th:with="mainClass='default-main'">
        <div th:fragment="content" class="w-full max-w-[960px] mx-auto flex flex-col gap-8">
            <div class="flex flex-col gap-2 border-b border-border-light dark:border-border-dark pb-6">
                <h2
                    class="text-3xl md:text-4xl font-black tracking-tight text-text-light-primary dark:text-text-dark-primary">
                    새로운 스터디 만들기</h2>
                <p class="text-text-light-secondary dark:text-text-dark-secondary text-base md:text-lg">함께 성장할 스터디 멤버를
                    모집해보세요.</p>
            </div>
            <form id="postForm" class="flex flex-col gap-8">
                <!-- 스터디 이름 -->
                <div class="flex flex-col gap-3">
                    <label for="title" class="text-lg font-bold text-text-light-primary dark:text-text-dark-primary">스터디
                        이름</label>
                    <input id="title"
                        class="w-full h-14 px-5 rounded-xl border border-border-light dark:border-border-dark bg-surface-light dark:bg-surface-dark text-text-light-primary dark:text-text-dark-primary placeholder:text-text-light-secondary dark:placeholder:text-text-dark-secondary focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all text-base"
                        placeholder="스터디의 주제가 잘 드러나는 이름을 입력해주세요." type="text" required />
                </div>

                <!-- 카테고리 -->
                <div class="flex flex-col gap-3">
                    <label class="text-lg font-bold text-text-light-primary dark:text-text-dark-primary">카테고리</label>
                    <div class="flex flex-wrap gap-3">
                        <label class="cursor-pointer">
                            <input type="radio" name="category" value="PROGRAMMING" class="peer sr-only" checked />
                            <div
                                class="flex items-center justify-center h-10 px-5 rounded-lg bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark text-text-light-secondary dark:text-text-dark-secondary font-medium peer-checked:bg-primary peer-checked:text-white peer-checked:border-primary transition-all hover:border-primary">
                                프로그래밍
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="category" value="LANGUAGE" class="peer sr-only" />
                            <div
                                class="flex items-center justify-center h-10 px-5 rounded-lg bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark text-text-light-secondary dark:text-text-dark-secondary font-medium peer-checked:bg-primary peer-checked:text-white peer-checked:border-primary transition-all hover:border-primary">
                                어학
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="category" value="EMPLOYMENT" class="peer sr-only" />
                            <div
                                class="flex items-center justify-center h-10 px-5 rounded-lg bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark text-text-light-secondary dark:text-text-dark-secondary font-medium peer-checked:bg-primary peer-checked:text-white peer-checked:border-primary transition-all hover:border-primary">
                                취업
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="category" value="EXAM" class="peer sr-only" />
                            <div
                                class="flex items-center justify-center h-10 px-5 rounded-lg bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark text-text-light-secondary dark:text-text-dark-secondary font-medium peer-checked:bg-primary peer-checked:text-white peer-checked:border-primary transition-all hover:border-primary">
                                고시/공무원
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="category" value="HOBBY" class="peer sr-only" />
                            <div
                                class="flex items-center justify-center h-10 px-5 rounded-lg bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark text-text-light-secondary dark:text-text-dark-secondary font-medium peer-checked:bg-primary peer-checked:text-white peer-checked:border-primary transition-all hover:border-primary">
                                취미/교양
                            </div>
                        </label>
                    </div>
                </div>

                <!-- 부가 정보 -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="flex flex-col gap-2">
                        <label class="text-base font-semibold text-text-light-primary dark:text-text-dark-primary">모집
                            인원</label>
                        <div class="relative">
                            <div
                                class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none text-text-light-secondary">
                                <span class="material-symbols-outlined">group</span>
                            </div>
                            <input
                                class="w-full h-12 pl-12 pr-4 rounded-xl border border-border-light dark:border-border-dark bg-surface-light dark:bg-surface-dark text-text-light-primary dark:text-text-dark-primary placeholder:text-text-light-secondary focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all"
                                max="50" min="1" placeholder="최대 참여 인원" type="number" />
                        </div>
                    </div>
                    <div class="flex flex-col gap-2">
                        <label class="text-base font-semibold text-text-light-primary dark:text-text-dark-primary">모집
                            시작일</label>
                        <div class="relative">
                            <div
                                class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none text-text-light-secondary">
                                <span class="material-symbols-outlined">calendar_today</span>
                            </div>
                            <input
                                class="w-full h-12 pl-12 pr-4 rounded-xl border border-border-light dark:border-border-dark bg-surface-light dark:bg-surface-dark text-text-light-primary dark:text-text-dark-primary focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all text-sm"
                                type="date" />
                        </div>
                    </div>
                    <div class="flex flex-col gap-2">
                        <label class="text-base font-semibold text-text-light-primary dark:text-text-dark-primary">모집
                            마감일</label>
                        <div class="relative">
                            <div
                                class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none text-text-light-secondary">
                                <span class="material-symbols-outlined">event_busy</span>
                            </div>
                            <input
                                class="w-full h-12 pl-12 pr-4 rounded-xl border border-border-light dark:border-border-dark bg-surface-light dark:bg-surface-dark text-text-light-primary dark:text-text-dark-primary focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all text-sm"
                                type="date" />
                        </div>
                    </div>
                </div>

                <!-- 소개글 -->
                <div class="flex flex-col gap-3">
                    <label for="content"
                        class="text-lg font-bold text-text-light-primary dark:text-text-dark-primary">소개글</label>
                    <textarea id="content"
                        class="w-full min-h-[240px] p-5 rounded-xl border border-border-light dark:border-border-dark bg-surface-light dark:bg-surface-dark text-text-light-primary dark:text-text-dark-primary placeholder:text-text-light-secondary dark:placeholder:text-text-dark-secondary resize-y focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all text-base leading-relaxed"
                        placeholder="스터디의 목표, 진행 방식, 커리큘럼 등 상세한 내용을 적어주세요.&#10;예시:&#10;- 매주 토요일 오후 2시 온라인 모임&#10;- 4주 완성 코스&#10;- 보증금 1만원 (완주 시 환급)"
                        required></textarea>
                </div>

                <!-- 지역 / 장소 선택 -->
                <div class="flex flex-col gap-3">
                    <label class="text-lg font-bold text-text-light-primary dark:text-text-dark-primary">지역 / 장소
                        선택</label>
                    <div
                        class="flex flex-col gap-4 p-4 rounded-xl border border-border-light dark:border-border-dark bg-surface-light dark:bg-surface-dark">
                        <div class="flex gap-2">
                            <div class="relative flex-grow">
                                <span
                                    class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-light-secondary">search</span>
                                <input
                                    class="w-full h-11 pl-10 pr-4 rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark focus:outline-none focus:border-primary transition-colors text-base text-text-light-primary dark:text-text-dark-primary"
                                    placeholder="지번, 도로명, 건물명으로 검색" type="text" />
                            </div>
                            <button
                                class="px-5 h-11 rounded-lg bg-text-light-primary dark:bg-text-dark-primary text-surface-light dark:text-surface-dark font-medium hover:opacity-90 transition-opacity whitespace-nowrap"
                                type="button">검색</button>
                        </div>
                        <div
                            class="relative w-full h-80 rounded-lg bg-[#e8e0d5] dark:bg-[#3d342b] overflow-hidden group cursor-crosshair border border-border-light dark:border-border-dark">
                            <div class="absolute inset-0 opacity-30">
                                <div class="absolute top-0 left-[20%] w-3 h-full bg-white dark:bg-white/10 rotate-6">
                                </div>
                                <div class="absolute top-0 left-[60%] w-4 h-full bg-white dark:bg-white/10 -rotate-3">
                                </div>
                                <div class="absolute top-[40%] left-0 w-full h-4 bg-white dark:bg-white/10 rotate-1">
                                </div>
                                <div class="absolute top-[70%] left-0 w-full h-3 bg-white dark:bg-white/10 -rotate-2">
                                </div>
                                <div class="absolute top-10 right-10 w-32 h-24 bg-green-500/10 rounded-2xl rotate-12">
                                </div>
                            </div>
                            <div
                                class="absolute top-[42%] left-10 text-[10px] text-text-light-secondary font-medium rotate-1 pointer-events-none opacity-60">
                                테헤란로</div>
                            <div
                                class="absolute bottom-[32%] right-20 text-[10px] text-text-light-secondary font-medium -rotate-2 pointer-events-none opacity-60">
                                강남대로</div>
                            <div
                                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-full flex flex-col items-center drop-shadow-xl transition-all duration-300 group-hover:-translate-y-[calc(100%+5px)]">
                                <span
                                    class="material-symbols-outlined text-5xl text-primary drop-shadow-md z-10">location_on</span>
                                <div class="w-3 h-1.5 bg-black/20 rounded-[100%] blur-[2px] mt-[-6px] z-0"></div>
                            </div>
                            <div
                                class="absolute bottom-4 right-4 flex flex-col gap-1 shadow-lg rounded-lg overflow-hidden">
                                <button
                                    class="size-9 bg-white dark:bg-surface-dark flex items-center justify-center text-text-light-secondary hover:text-primary hover:bg-gray-50 dark:hover:bg-gray-800 border-b border-border-light dark:border-border-dark"
                                    type="button"><span class="material-symbols-outlined text-xl">add</span></button>
                                <button
                                    class="size-9 bg-white dark:bg-surface-dark flex items-center justify-center text-text-light-secondary hover:text-primary hover:bg-gray-50 dark:hover:bg-gray-800"
                                    type="button"><span class="material-symbols-outlined text-xl">remove</span></button>
                            </div>
                        </div>
                        <div
                            class="flex flex-col sm:flex-row sm:items-center justify-between gap-3 bg-background-light dark:bg-background-dark p-3 rounded-lg border border-border-light dark:border-border-dark">
                            <div
                                class="flex items-center gap-2 text-sm text-text-light-secondary dark:text-text-dark-secondary">
                                <span class="material-symbols-outlined text-primary">my_location</span>
                                <span>선택된 위치: <strong
                                        class="text-text-light-primary dark:text-text-dark-primary ml-1">서울특별시 강남구
                                        테헤란로 123</strong></span>
                            </div>
                            <button class="text-xs font-bold text-primary hover:underline" type="button">현재 위치로
                                찾기</button>
                        </div>
                    </div>
                </div>

                <div
                    class="flex flex-col-reverse md:flex-row gap-4 pt-4 border-t border-border-light dark:border-border-dark mt-4">
                    <a th:href="@{'/page/post'}"
                        class="flex-1 md:flex-none md:w-32 h-12 rounded-xl border border-border-light dark:border-border-dark bg-surface-light dark:bg-surface-dark text-text-light-primary dark:text-text-dark-primary font-bold hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors flex items-center justify-center">
                        취소
                    </a>
                    <button type="submit"
                        class="flex-1 h-12 rounded-xl bg-primary text-white font-bold hover:bg-opacity-90 shadow-lg shadow-primary/20 hover:shadow-primary/40 transition-all flex items-center justify-center gap-2">
                        <span class="material-symbols-outlined text-xl">add_circle</span>
                        스터디 개설하기
                    </button>
                </div>
            </form>
            <script>
                document.getElementById("postForm").addEventListener("submit", async function (e) {
                    e.preventDefault();

                    // 새로운 디자인에 맞춘 데이터 수집
                    const titleEl = document.getElementById("title");
                    const contentEl = document.getElementById("content");
                    // 카테고리는 라디오 버튼 중 체크된 것의 값
                    // (백엔드가 'STUDY' 카테고리만 받는다면 아래 postCategory를 'STUDY'로 고정하고, 
                    //  세부 주제는 내용에 붙이거나 별도 필드 처리 필요)
                    const categoryEl = document.querySelector('input[name="category"]:checked');

                    const data = {
                        title: titleEl.value,
                        // 기존 로직 호환성을 위해 postCategory는 'STUDY'로 고정 (페이지 성격상)
                        postCategory: 'STUDY',
                        // 대신 본문에 세부 카테고리 등을 포함시킬 수도 있음 (나중에 구현)
                        content: contentEl.value,
                        isNotice: false
                    };

                    try {
                        const res = await fetch("/api/post/insert", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(data)
                        });
                        if (res.ok) {
                            window.location.href = "/page/post";
                        } else {
                            alert("게시글 작성에 실패했습니다.");
                        }
                    } catch (err) {
                        console.error(err);
                        alert("에러가 발생했습니다.");
                    }
                });
            </script>
        </div>
    </div>
</body>

</html>