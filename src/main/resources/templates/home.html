<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="">
<head>
    <meta charset="UTF-8">
    <title>WeStudy Home</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<h1>🚀 Welcome to WeStudy!</h1>
<p>This is the home page rendered by Thymeleaf.</p>

<!-- 로그인 상태에 따라 버튼이 표시될 영역 -->
<div id="auth-buttons">
    <!-- JS 에서 로그인 상태 확인 후 여기에 버튼 추가 -->
</div>

<div class="footer">WeStudy © 2025</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const authButtonsDiv = document.getElementById("auth-buttons");

        // ⭐️ 로그인 상태 확인 요청
        fetch('/api/auth/check', {
            method: 'GET',
            credentials: 'include' // ⭐️ 쿠키 포함!
        })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Not authenticated');
                }
            })
            .then(userInfo => {
                console.log('로그인 상태:', userInfo);

                // ✅ 닉네임 표시 + 로그아웃 버튼
                authButtonsDiv.innerHTML = `
                <p><strong>${userInfo.nickname}</strong> 님 환영합니다!</p>
                <form action="/users/logout" method="post">
                    <button type="submit">로그아웃</button>
                </form>
            `;
            })
            .catch(err => {
                console.log('로그인 안됨');

                // ✅ 로그인 버튼 표시
                authButtonsDiv.innerHTML = `
                <a href="/login">
                    <button type="button">로그인</button>
                </a>
            `;
            });
    });
</script>
</body>
</html>
