<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="">
<head>
    <meta charset="UTF-8">
    <title>WeStudy Home</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<h1>ğŸš€ Welcome to WeStudy!</h1>
<p>This is the home page rendered by Thymeleaf.</p>

<!-- ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ì´ í‘œì‹œë  ì˜ì—­ -->
<div id="auth-buttons">
    <!-- JS ì—ì„œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ í›„ ì—¬ê¸°ì— ë²„íŠ¼ ì¶”ê°€ -->
</div>

<div class="footer">WeStudy Â© 2025</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const authButtonsDiv = document.getElementById("auth-buttons");

        // â­ï¸ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ìš”ì²­
        fetch('/api/auth/check', {
            method: 'GET',
            credentials: 'include' // â­ï¸ ì¿ í‚¤ í¬í•¨!
        })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Not authenticated');
                }
            })
            .then(userInfo => {
                console.log('ë¡œê·¸ì¸ ìƒíƒœ:', userInfo);

                // âœ… ë‹‰ë„¤ì„ í‘œì‹œ + ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
                authButtonsDiv.innerHTML = `
                <p><strong>${userInfo.nickname}</strong> ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!</p>
                <form action="/users/logout" method="post">
                    <button type="submit">ë¡œê·¸ì•„ì›ƒ</button>
                </form>
            `;
            })
            .catch(err => {
                console.log('ë¡œê·¸ì¸ ì•ˆë¨');

                // âœ… ë¡œê·¸ì¸ ë²„íŠ¼ í‘œì‹œ
                authButtonsDiv.innerHTML = `
                <a href="/login">
                    <button type="button">ë¡œê·¸ì¸</button>
                </a>
            `;
            });
    });
</script>
</body>
</html>
